{"version":3,"file":"configHandler.js","sourceRoot":"","sources":["../../../shared/configSetup/configHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import { PathLike, readFileSync } from 'fs';\nimport * as path from 'path';\nimport { ConfigFileLocation } from './configFileLocation';\n\nexport enum EnvironementMode {\n  'prod' = 'prod',\n  'test' = 'test',\n  'dev' = 'dev',\n  'custom' = 'custom'\n}\n\nexport class ConfigHandler {\n  public finalConfig: any;\n  private environmentVariables: any;\n  public environmentMode: any;\n\n  constructor(configFileLocation: ConfigFileLocation, configInitial = 'config_') {\n    this.environmentVariables = this.getEnvironmentVariables(configInitial);\n    const configPath = this.resolveConfigFileLocation(configFileLocation);\n    this.getConfig(configPath);\n  }\n\n  private getEnvironmentVariables(configInitial): any {\n    const env: Object = process.env;\n    const envConfig = {};\n    Object.keys(env)\n        .filter(key => key.includes(configInitial, 0))\n        .forEach(key => {\n          envConfig[key] = env[key];\n        });\n    return envConfig;\n  }\n\n\n  /**\n   * This is the foo function\n   * @param configFileLocation This is the bar parameter\n   * @returns returns a string version of bar\n   */\n  public resolveConfigFileLocation(configFileLocation) {\n    let configPath;\n    // todo change to config_env to environment_mode\n    console.log(this.environmentVariables.config_env);\n    this.environmentMode = this.environmentVariables.config_env;\n    switch (this.environmentMode) {\n      case EnvironementMode.prod:\n        configPath = configFileLocation.CONFIG_PATH_PROD;\n        break;\n      case EnvironementMode.test:\n        configPath = path.join(__dirname, configFileLocation.CONFIG_PATH_TEST);\n        break;\n      case EnvironementMode.custom:\n        configPath = process.env.configFileLocation;\n        break;\n      case EnvironementMode.dev :\n      default:\n        configPath = path.join(__dirname, configFileLocation.CONFIG_PATH_DEV);\n    }\n    return configPath;\n\n  }\n\n  private getConfig(path: PathLike): any {\n    const configFileObject = this.readConfigFile(path);\n    this.compereObjectToFlat(configFileObject, this.environmentVariables);\n    return this.finalConfig = configFileObject;\n  }\n\n  private readConfigFile(path: PathLike): any {\n    const configString = readFileSync(path, 'utf8');\n    return JSON.parse(configString);\n  }\n\n\n  private compereObjectToFlat(objectToIterate, toCompere): void {\n    function iterateRecursive(object) {\n      Object.keys(object)\n          .forEach(key => {\n            const value = object[key];\n            if (typeof value === 'object') {\n              iterateRecursive(value);\n            }\n            else {\n              object[key] = toCompere[key] || value;\n            }\n          });\n    }\n\n    iterateRecursive(objectToIterate);\n  }\n\n\n}\n\n\n\n"]}