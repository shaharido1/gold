{"version":3,"file":"configHandler.js","sourceRoot":"","sources":["../../../../../shared/configSetup/configHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import { PathLike, readFileSync } from 'fs';\r\nimport * as path from 'path';\r\nimport { ConfigFileLocation } from './configFileLocation';\r\n\r\n\r\nexport class ConfigHandler {\r\n  public finalConfig: any;\r\n  private environmentVariables: any;\r\n  public environmentMode: any;\r\n\r\n  constructor(configFileLocation: ConfigFileLocation, configInitial = 'config_', testMode?: boolean) {\r\n    this.environmentVariables = this.getEnvironmentVariables(configInitial);\r\n    const configPath = this.resolveConfigFileLocation(configFileLocation, testMode);\r\n    this.getConfig(configPath);\r\n  }\r\n\r\n  private getEnvironmentVariables(configInitial): any {\r\n    const env: Object = process.env;\r\n    const envConfig = {};\r\n    Object.keys(env)\r\n        .filter(key => key.includes(configInitial, 0))\r\n        .forEach(key => {\r\n          envConfig[key] = env[key];\r\n        });\r\n    return envConfig;\r\n  }\r\n\r\n  private resolveConfigFileLocation(configFileLocation, testMode?: boolean) {\r\n    let configPath;\r\n    // todo change to environment_mode\r\n    if (testMode) {\r\n      this.environmentMode = 'test';\r\n    }\r\n    else {\r\n      this.environmentMode = this.environmentVariables.config_env;\r\n    }\r\n\r\n    switch (this.environmentMode) {\r\n      case 'prod':\r\n        configPath = configFileLocation.CONFIG_PATH_PROD;\r\n        break;\r\n      case 'test':\r\n        configPath = path.join(__dirname, configFileLocation.CONFIG_PATH_TEST);\r\n        break;\r\n      case 'custom':\r\n        configPath = process.env.configFileLocation;\r\n        break;\r\n      default:\r\n        configPath = path.join(__dirname, configFileLocation.CONFIG_PATH_DEV);\r\n    }\r\n    return configPath;\r\n\r\n  }\r\n\r\n  private getConfig(path: PathLike): any {\r\n    const configFileObject = this.readConfigFile(path);\r\n    this.compereObjectToFlat(configFileObject, this.environmentVariables);\r\n    return this.finalConfig = configFileObject;\r\n  }\r\n\r\n  private readConfigFile(path: PathLike): any {\r\n    const configString = readFileSync(path, 'utf8');\r\n    return JSON.parse(configString);\r\n  }\r\n\r\n\r\n  private compereObjectToFlat(objectToIterate, toCompere): void {\r\n    function iterateRecursive(object) {\r\n      Object.keys(object)\r\n          .forEach(key => {\r\n            const value = object[key];\r\n            if (typeof value === 'object') {\r\n              iterateRecursive(value);\r\n            }\r\n            else {\r\n              object[key] = toCompere[key] || value;\r\n            }\r\n          });\r\n    }\r\n\r\n    iterateRecursive(objectToIterate);\r\n  }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n"]}